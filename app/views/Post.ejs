<!DOCTYPE html>
<html lang="en">

<head>
    <meta charset="utf-8" />
    <meta name="viewport" content="width=device-width, initial-scale=1" />
    <title>Blogger.com</title>
    <link href="https://cdn.jsdelivr.net/npm/bootstrap@5.3.1/dist/css/bootstrap.min.css" rel="stylesheet"
        integrity="sha384-4bw+/aepP/YC94hEpVNVgiZdgIC5+VKNBQNGCHeKRQN+PtmoHDEXuppvnDJzQIu9" crossorigin="anonymous" />
    <link rel="icon" type="image/x-icon" href="favicon.png">
    <link rel="preconnect" href="https://fonts.googleapis.com">
    <link rel="preconnect" href="https://fonts.gstatic.com" crossorigin>
    <script src="https://cdn.ckeditor.com/ckeditor5/41.1.0/classic/ckeditor.js"></script>
    <link
        href="https://fonts.googleapis.com/css2?family=Bitter:wght@400;500&family=Roboto+Slab:wght@400;500&display=swap"
        rel="stylesheet">
</head>


<body class="bg-light d-flex flex-column" style="min-height: 100vh; font-family:'Roboto Slab', serif;">

    <%- include('Navbar') -%>
        <div class="flex-grow-1 d-flex justify-content-center flex-column">
            <div class="container d-flex  flex-column">
                <!-- <h1><%= post.postId %></h1> -->
                <img src="http://localhost:3001/<%= post.image %>" style="height: 200px;">

                <h3>
                    <%= post.title %>
                </h3>

                <!-- <li>
                        <h3>
                            <%= post.postId %>
                        </h3>
                    </li> -->

                <p>
                    <%- post.content %>
                    
                </p>

                <div class="d-flex align-self-end">
                    <figcaption class="blockquote-footer">
                        Author: <b>
                            <%= writer %>
                        </b>
                    </figcaption>
                    <figcaption class="blockquote-footer">Created At: <%= post.createdAt.getDate() %>/<%=
                                post.createdAt.getMonth() + 1 %>/<%= post.createdAt.getFullYear() %>
                    </figcaption>


                    <figcaption class="blockquote-footer">
                        Updated At: <%= post.updatedAt.getDate() %>/<%= post.updatedAt.getMonth() + 1 %>/<%=
                                    post.updatedAt.getFullYear() %>
                    </figcaption>
                </div>



            </div>
            <% if((session?.user?.AdminId==post?.AdminAdminId) || session?.user?.isAdmin){%>

                <div class="d-flex justify-content-around">
                    <button id="updatePostBtn" class="btn btn-primary">Update Post</button>
                    <button id="deletePostBtn" class="btn btn-danger">Delete Post</button>
                </div>
                <% } else { %>
                    <div class="d-flex justify-content-around">
                        <figcaption class="blockquote-footer">
                            <div class="d-flex align-self-end">
                                <figcaption class="blockquote-footer">
                                    You Do not have access to Edit this post
                                </figcaption>
                            </div>
                        </figcaption>
                    </div>
                    <% } %>
        </div>
        <%=console.log(session?.user)%>
            <%=console.log(post?.AdminAdminId)%>


                <!-- <div class="d-flex justify-content-around">
            <button id="updatePostBtn" class="btn btn-primary">Update Post</button>
            <button id="deletePostBtn" class="btn btn-danger">Delete Post</button>
        </div> -->
                <%- include('Footer') %>

                    <script src="https://cdn.jsdelivr.net/npm/bootstrap@5.3.1/dist/js/bootstrap.bundle.min.js"
                        integrity="sha384-HwwvtgBNo3bZJJLYd8oVXjrBZt8cqVSpeBNS5n7C8IVInixGAoxmnlMuBnhbgrkm"
                        crossorigin="anonymous"></script>
                    <script>
                        document.addEventListener('DOMContentLoaded', function () {
                            const updatePostBtn = document.getElementById('updatePostBtn');
                            const deletePostBtn = document.getElementById('deletePostBtn');

                            // Add event listener for updating a post
                            updatePostBtn.addEventListener('click', function () {
                                // Redirect or perform any action for updating the post
                                window.location.href = 'http://localhost:3001/updatepost?p=<%= post.postId %>';
                            });

                            // Add event listener for deleting a post
                            deletePostBtn.addEventListener('click', function () {
                                // Perform any action for deleting the post, for example, show a confirmation dialog
                                const confirmation = confirm('Are you sure you want to delete this post?');
                                if (confirmation) {
                                    // Redirect or perform any action for deleting the post
                                    window.location.href = `http://localhost:3001/`;
                                    deletePost();
                                }
                            });
                           
                        });
                        function deletePost() {
                            // Use fetch to send a DELETE request
                            fetch('http://localhost:3001/post/delete/<%= post.postId %>', {
                                method: 'POST',
                                headers: {
                                    'Content-Type': 'application/json',
                                    // You may need to include additional headers, like authorization headers
                                },
                                // You can include a request body if needed (depends on your server setup)
                                // body: JSON.stringify({}),
                            })
                                .then(response => {
                                    if (!response.ok) {
                                        throw new Error(`HTTP error! Status: ${response.status}`);
                                    }
                                    // Handle success response, e.g., refresh the page or perform other actions
                                    console.log('Post deleted successfully');
                                    window.location.reload(); // Refresh the page after successful deletion
                                })
                                .catch(error => {
                                    // Handle errors, e.g., show an error message to the user
                                    console.error('Error deleting post:', error.message);
                                });
                        }
                    </script>
</body>

</html>